(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{577:function(s,e,n){"use strict";n.r(e);var a=n(9),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"什么是-promise"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-promise"}},[s._v("#")]),s._v(" 什么是 Promise?")]),s._v(" "),n("p",[n("strong",[s._v("Promise")]),s._v(" 是ES6提供的一个原生的构造函数，我们可以打印看一下这个构造函数：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("console.log(Promise)\n打印结果： ƒ Promise() { [native code] }\nconsole.log(typeof Promise)\n打印结果： function\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/663b8e1f30a142b588341930f800bc79~tplv-k3u1fbpfcp-watermark.image?",alt:"截屏2021-10-08 上午11.20.52.png"}})]),s._v(" "),n("p",[s._v("可以看到 "),n("code",[s._v("Promise")]),s._v(" 是一个构造函数，自身有"),n("code",[s._v("all")]),s._v("、"),n("code",[s._v("reject")]),s._v("、"),n("code",[s._v("resolve")]),s._v("这几个方法，原型上有"),n("code",[s._v("then")]),s._v("、"),n("code",[s._v("catch")]),s._v("等方法。\n用"),n("code",[s._v("new")]),s._v("关键字和"),n("code",[s._v("Promise")]),s._v("构造器创建它的对象。该函数接受两个函数参数。当异步成功时，第一个函数（"),n("code",[s._v("resolve")]),s._v("）将被调用，并返回一个值代表成功。当其失败时，第二个函数（"),n("code",[s._v("reject")]),s._v("）将被调用，并返回失败原因。")]),s._v(" "),n("h2",{attrs:{id:"一个简单的例子"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一个简单的例子"}},[s._v("#")]),s._v(" 一个简单的例子")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const myFirstPromise = new Promise((resolve, reject) => {\n    setTimeout(() => {\n        Math.random() > 0.5 ? resolve('success') : reject('fail');\n    }, 1000);\n});\n\nconsole.log(myFirstPromise); // Promise {<pending>}\n\nmyFirstPromise.then((result) => {\n    console.log(result);\n}, (err) => {\n    console.log(err);\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("一个 "),n("code",[s._v("Promise")]),s._v(" 必然处于以下几种状态之一：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("等待（pending）")]),s._v(" : 初始状态，既没有被完成，也没有被拒绝。")]),s._v(" "),n("li",[n("strong",[s._v("已实现（fulfilled）")]),s._v(" : 意味着操作成功完成。")]),s._v(" "),n("li",[n("strong",[s._v("已拒绝（rejected）")]),s._v(" : 意味着操作失败。")])]),s._v(" "),n("p",[n("code",[s._v("then()")]),s._v("方法返回一个"),n("code",[s._v("Promise")]),s._v("它最多有两个参数：Promise 的成功和失败情况的回调函数。")]),s._v(" "),n("p",[s._v("第一个参数("),n("code",[s._v("onFulfilled")]),s._v(")：当"),n("code",[s._v("Promise")]),s._v("的状态为"),n("code",[s._v("fulfilled")]),s._v("时被调用，该函数有一个参数，即完成的最终结果。如果该参数不是一个函数，则会被内部替换为"),n("code",[s._v("(x) => x")]),s._v(", 即原样返回 Promise 最终结果的函数。")]),s._v(" "),n("p",[s._v("第二个参数("),n("code",[s._v("onRejected")]),s._v(")：当"),n("code",[s._v("Promise")]),s._v("的状态为"),n("code",[s._v("rejected")]),s._v("时被调用，该函数有一个参数，即拒绝的原因。如果该参数不是一个函数，则会被内部替换为一个"),n("code",[s._v('"Thrower" 函数 (it throws an error it received as argument)')]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("myFirstPromise.then((result) => {\n    // 当 Promise 被 fulfilled 时\n    console.log(result);\n}).catch((reason) => {\n    // 当 Promise 被 rejected 时\n    console.log(reason);\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("code",[s._v("catch()")]),s._v("方法返回一个"),n("code",[s._v("Promise")]),s._v("并且处理拒绝的情况。它的行为与调用"),n("code",[s._v("then(undefined, onRejected)")]),s._v(" 相同。")]),s._v(" "),n("p",[n("code",[s._v("catch()")]),s._v("接受一个参数 (回调函数)：")]),s._v(" "),n("p",[s._v("当"),n("code",[s._v("Promise")]),s._v("被"),n("code",[s._v("rejected")]),s._v("时调用的函数。该函数拥有一个参数"),n("code",[s._v("reason")]),s._v("("),n("code",[s._v("rejected")]),s._v("的原因)")]),s._v(" "),n("p",[s._v("如果这个参数 (指的是 "),n("code",[s._v("onRejected")]),s._v(") 不是函数时，也是会报错的。"),n("strong",[s._v("这与 "),n("code",[s._v("then()")]),s._v(" 方法中第二个参数不是函数的情况吻合。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("myFirstPromise.finally(() => {\n\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("code",[s._v("finally()")]),s._v("方法在 Promise 结束时，无论结果是"),n("code",[s._v("fulfilled")]),s._v("还是"),n("code",[s._v("rejected")]),s._v("，都会执行的回调函数。这样可以避免同样的语句需要在"),n("code",[s._v("then()")]),s._v("和"),n("code",[s._v("catch()")]),s._v("中都要写一次的情况。")]),s._v(" "),n("p",[s._v("如果你想在"),n("code",[s._v("Promise")]),s._v("执行完毕后无论其结果怎样都做一些处理或清理时"),n("code",[s._v("finally()")]),s._v("方法或许是你需要的。")]),s._v(" "),n("p",[n("code",[s._v("finally()")]),s._v("方法的回调函数不接受任何参数，这意味着没有办法知道前面的"),n("code",[s._v("Promise")]),s._v("状态到底是"),n("code",[s._v("fulfilled")]),s._v("还是"),n("code",[s._v("rejected")]),s._v("。\n这表明"),n("code",[s._v("finally")]),s._v("仅用于无论最终结果如何都要执行的情况，而不能依赖"),n("code",[s._v("Promise")]),s._v("执行结果。")]),s._v(" "),n("p",[n("code",[s._v("finally()")]),s._v("方法本身无异常抛出的情况下，总是会返回原来的"),n("code",[s._v("Promise")]),s._v("对象值；若抛出异常，则返回异常的 Promise`对象。\n")]),n("p",{attrs:{align:"right"}},[n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"}},[s._v("更多关于Promise>>>")])]),n("p"),s._v(" "),n("h2",{attrs:{id:"promise-存在的意义是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promise-存在的意义是什么"}},[s._v("#")]),s._v(" Promise 存在的意义是什么？")]),s._v(" "),n("p",[s._v("我们都知道"),n("code",[s._v("Promise()")]),s._v("执行是同步的，而"),n("code",[s._v("then()")]),s._v("执行是异步的，为什么？")]),s._v(" "),n("p",[s._v("为什么"),n("code",[s._v("Promise()")]),s._v("执行是同步的，而 "),n("code",[s._v("then()")]),s._v("执行是异步的呢？我就想把"),n("code",[s._v("then()")]),s._v("设计成同步不行吗？")]),s._v(" "),n("p",[s._v("那么先看一个ajax的例子测试，这里用的是"),n("code",[s._v("jquery")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('data.json\n[\n    {\n        "id": 1,\n        "name": "zhangsan"\n    },\n    {\n        "id": 2,\n        "name": "lisi"\n    },\n    {\n        "id": 3,\n        "name": "wangwu"\n    },\n    {\n        "id": 7,\n        "name": "LPieces"\n    }\n]\n\nindex.js\n// 异步程序\n$.ajax({\n    url: "http://localhost:3000/data.json",\n    success (data) {\n        console.log(data.map(item=>item.name));\n    }\n});\nconsole.log("My name is LPieces.");\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d98b058ed3941b294ff361509fe3a80~tplv-k3u1fbpfcp-watermark.image?",alt:"截屏2021-10-11 上午11.19.37.png"}})]),s._v(" "),n("p",[s._v("上面的代码中"),n("code",[s._v("$.ajax()")]),s._v("是异步程序，而js执行是从上往下同步执行，当异步程序请求没回来时，下面"),n("code",[s._v("console.log()")]),s._v("当然就打印了这个很简单。那现在我想要把"),n("code",[s._v("success")]),s._v("中的操作抽离到外层出来怎么做呢？看下面的代码：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('// 异步程序\nconst data = $.ajax({\n    url: "http://localhost:3000/data.json",\n    async: false // 同步\n});\nconsole.log(data.responseJSON.map(item=>item.name));\nconsole.log("My name is LPieces.");\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16fe2875fb904297a50cefba5d2f1525~tplv-k3u1fbpfcp-watermark.image?",alt:"截屏2021-10-11 下午6.19.25.png"}})]),s._v(" "),n("p",[s._v("当我设置了"),n("code",[s._v("async: false")]),s._v("上面的"),n("code",[s._v("ajax")]),s._v("和下面的打印就形成了同步的关系，虽然实现了我想要的结果，但是打印的"),n("code",[s._v("My name is LPieces")]),s._v("跑到下面去了，它要等着上面"),n("code",[s._v("ajax")]),s._v("执行完才打印出来，那这就不对了哦，这会阻塞了下面所有的代码。既然这样，来看看"),n("code",[s._v("Promise")]),s._v("怎么帮我解决这个问题：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("const p = new Promise((resolve, reject) => {\n    $.ajax({\n        url: 'http://localhost:3000/data.json',\n        success (data) {\n            resolve(data);\n        }\n    })\n})\np.then(res => {\n    console.log(res.map(item=>item.name));\n})\nconsole.log(\"My name is LPieces.\");\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cc7c5f86c1e441e381a734e9b353e2b9~tplv-k3u1fbpfcp-watermark.image?",alt:"截屏2021-10-12 上午10.11.40.png"}})]),s._v(" "),n("p",[s._v("是不是完美的解决了阻塞的问题呀，到这里应该能理解为什么"),n("code",[s._v("Promise()")]),s._v("的执行一定是同步的，而 "),n("code",[s._v("then()")]),s._v("的执行一定是异步的了吧，如果"),n("code",[s._v("then()")]),s._v("是同步执行的话，那么就会回到上面阻塞的问题去了，那我设置"),n("code",[s._v("async: false")]),s._v("不香吗？干嘛还要写个"),n("code",[s._v("Promise")]),s._v("包裹"),n("code",[s._v("ajax")]),s._v("的代码呢？")]),s._v(" "),n("h3",{attrs:{id:"promise-的存在是解决回调地狱吗"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promise-的存在是解决回调地狱吗"}},[s._v("#")]),s._v(" Promise 的存在是解决回调地狱吗？")]),s._v(" "),n("p",[n("code",[s._v("Promise")]),s._v("只是顺便解决回调地狱，解决回调地狱最好的方法是"),n("code",[s._v("Promise + async awiat")]),s._v("的结合，举个栗子：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('function getData(){\n    return new Promise((resolve, reject) => {\n        // 注：当然 ajax 本身也有 Promise , 这里只是举个栗子\n        $.ajax({\n            url: \'http://localhost:3000/data.json\',\n            success (data) {\n                resolve(data);\n            }\n        })\n    })\n}\nasync function doSth(){\n    try{\n        const data = await getData();\n        console.log(data.map(item=>item.name));\n        console.log("My name is LPieces.");\n    }catch(err){\n        console.log(err);\n    }\n}\ndoSth();\nconsole.log("My name is LPieces.");\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("运行结果：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17caeba4043141e88946145b922bec44~tplv-k3u1fbpfcp-watermark.image?",alt:"截屏2021-10-12 上午10.56.09.png"}})]),s._v(" "),n("p",[n("code",[s._v("doSth()")]),s._v("和下面的打印是同步的执行关系。在"),n("code",[s._v("doSth()")]),s._v("里处理异步请求，如果需要上一个请求有结果后再请求，一路"),n("code",[s._v("await")]),s._v("下去就行了。")]),s._v(" "),n("h3",{attrs:{id:"promise-存在的意义是异步问题同步化解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#promise-存在的意义是异步问题同步化解决方案"}},[s._v("#")]),s._v(" "),n("strong",[s._v("Promise 存在的意义是异步问题同步化解决方案")])])])}),[],!1,null,null,null);e.default=t.exports}}]);